# HOWTO: Simple Note Soup Deployment on Ubuntu 11.10 64bit t1.micro from Canonical
#
# full image list here: http://uec-images.ubuntu.com/releases/11.10/release/
#
# (note that 32-bit instances may have better Redis memory performance)
#
- TODO: update redis config
	- where is the data?
	- what changes

- TODO: redis data file backup

- TODO: make forever start soup.js at restart

- TODO: production should use redis session data store

=====

INSTALL

# launch an EC2 instance
https://console.aws.amazon.com/ec2/home?region=us-east-1#launchAmi=ami-bf62a9d6

SECURITY: Ensure port 3000 inbound is open in the Security Group you launch with
	- or open it later when you discover you can't hit the server

# LOCAL: if needed, on the local machine: set up .pem file:
mv ~/Downloads/notesoup.pem ~/.ssh
chmod 400 ~/.ssh/notesoup.pem

# LOCAL: ssh to the instance
ssh -i ~/.ssh/notesoup.pem ubuntu@ec2-67-202-59-193.compute-1.amazonaws.com

# REMOTE: on the instance from here

sudo apt-get update
sudo apt-get upgrade
sudo apt-get install git nodejs redis-server g++

# NPM via apt-get is too old - 0.2.19 - let's install clean 1.0.106
curl http://npmjs.org/install.sh | sudo sh

# install note soup
cd ~
git clone ssh://talky@bitlash.net/~/notesoup-node.git
cd notesoup-node
node loadsoup.js
# ^C to exit when done

# run the server for a quick test
node soup.js

# browse to http://localhost:3000 or http://yourserver:3000
# ^C to exit or just let it babble

# install 'forever' to run the server ...needs C compiler, see above
#apt-get install g++
#apt-get install g++
sudo npm install -g forever

# run the server until reboot and dump logs to ~/.forever:
forever start -o out.log -e err.log -l forever.log soup.js


- Give the server a name like "alpha.notesoup.net"
	- sign in to DNS provider
	- set up CNAME record pointing to the server:
		ec2-67-202-59-193.compute-1.amazonaws.com.
		- don't forget the dot at the end


################################################################################

Database build procedure:

!!! CAUTION THIS "FLUSHDB" IS THROWS AWAY ALL EXISTING CONTENT !!!
!!! CAUTION THIS "FLUSHDB" IS THROWS AWAY ALL EXISTING CONTENT !!!
!!! CAUTION THIS "FLUSHDB" IS THROWS AWAY ALL EXISTING CONTENT !!!

# DELETE ALL THE DATA IN THE REDIS STORE
redis-cli flushdb

# Load the baseline soup into the database
node loadsoup.js
(^C when it's done)

The default system password is: frobozz88
- todo: setpass.js

Log in as system, go to Templates, and Make Templates
Log out
Log in as Guest
Make a Clock
	Add Menu -> Add From My Templates -> Clock

This is the Initial Soup.

################################################################################

LOGGING

- forever logs for the server are in ~/.forever
- redis logging TBD
