Notesoup/Node/Redis TODO list
12/27/11 -br


- bug: /refresh crashes the server
	- race condx / headers complaint

 grep -rl "\"id\":" . | more
 grep -rl "\"syncme\":" . | xargs edit
===

- consider a single noteid counter
	- guaranteed unique throughout the soup
	- send-original moves the same id to the new space
	- send-copy assigns a new id to the sent copy in the new space

- BUG:
	- CRASH: erase all notes crashes the server
		deletes the same note over and over
		this looks like an ajax api flood
		first 4 go ok

	- Send uses sendnote?!/! recode...

	- BUG: send race? send all to trash doesn't clear all the notes from the source
		- seems unpredictable. race?

	- BUG: deleting large numbers of notes fails
		- gets complaint about response headers
		- needs two changes:
			- accept a note list?
			- use the async pipeline?

===
ACL support

- user info storage rework
	hash: user/guest {
		hash: passwordhash,
		for later: email: email, ...
	}

- load user passwd and folder attributes in loaduser/loadfolder

- acl modes
	- strict: like old soup: respect ACL
	- loose: anyone goes anywhere except system
		- effectively no login required

- python acl parser: review and redo


===
- widget bugs
	- porthole needs getnote
	- rss: needs /getfeed service
	- polling: generates Ext.get() error

===
- sound is broken
	SoundManager2
		requires flash
		http://www.schillmania.com/projects/soundmanager2/doc/download/
	JPlayer
		http://www.jplayer.org/
	html5 div hack

===

- createFolder: add "created" to folder hash on create
	- getfolderlist should use fldr/ attribute
	- deletefolder should delete fldr/attribute
	(problem? or feature? this allows for hidden folders... in other words, lost folders.)

===

API buildout 

- BIG BUG: ACL and error checks across the API
	- api_anon_ vs. api_
	- BUG: there is no error handling
	- BUG: there is no ACL checking

- bug: # Only a few methods should allowed if we're not logged in
- bug: Some methods should only be allowed for the 'system' user

- bug: unimplemented API:
	if method == 'getfeed': return apigetfeed(params)
	if method == 'getnote': return apigetnote(params)
		- needed for portable hole
		- can't it check the cache first?

	# Command below this point are only allowed for logged-in requestors

	if method == 'setfolderpassword': return apisetfolderpassword(params)
		- use api_setfolderacl {password: password}
		- checking the password requires http auth or equiv - how in node?

	if method == 'copyfolder': return apicopyfolder(params)
	if method == 'deleteuser': return apideleteuser(params)

	if method == 'postevent': return apipostevent(params)

===
Production 

- alpha server on http://alpha.notesoup.net:3000
	- todo: run nodejs at boot time
	- todo: server logs???
	- todo: backup .db
		- script to copy db to dbbackups/db-date
		- cron to run it

- Redis 32 bit vs 64 bit
	- next server rebuild use 32 bit

===
Notification plumbing issues

- bug: note color change doesn't go on notify bus, waits for sync instead
	- notify plumbing (tofolder...)
- bug: /say blah
	- "undefined says: blah"
	- username wiring in the message layer

- bug: need better handling for expired sessions
	- server restart kills sessions 
	- they can time out anyway
	- client thinks it's logged in
	- ...
	
====
Feature candidates

- startup: command line option for push server on/off
	- npm install optimist

- multi-tenancy via Host: header / database index map

- notesoup time machine
	- infinite undo/redo
	- pushbutton backup/restore
===

- bug: css for note titles is different from tiny soup?!

===

Note Content and Import/Export

- BUG: node load.js and loadsoup.js don't terminate properly

- startup: auto load system and widgets if they aren't there
- loadnotes: 
	capture .files for acl
- loaduser
	capture .passwd file
- dumpnotes
	- the redis-dump script is a nice temporary solution

- guest user: content in template/soupbase/guest
	- folder permissions
	- welcome/help
	- auto-refresh every 15 minutes
- new user: content in template/soupbase/newuser
- improved system/ and widget/ content
- feat: produce notelist for doCommand/paste restore
	.getjson() does it
	- (part done: backup note does this clumsily now by popping a window)
	- make a way to copy
	- send via email would be nice too

===

- project: SQUEEZENOTE
	- make the baseline note attributes as small as possible
	- right now they dominate the payload
	- fixup every place that uses the attributes
	- hack loadfile to map attributes
	c, x, y, w, h, t, n, z, i,
	free: abdefgjklmopqrsuv
	
	meta: id, mtime, folder, permissions

	RESOLVES:
		- bug: mtimes in the note, or not?
			- savenote, sendnote, loadfiles
		- bug: same for id?

Ext v99?  Touch?  Mac?

