{"xPos":297,"from":"system from widgets/time","bgcolor":"#99CCFF","text":"<script type='text/javascript'>\n/**\n*\tcountdown.js - Note Soup count down timer widget\n*\tCopyright 2007 by Bill Roy\n*\tAll rights reserved.\n*/\nvar note = notesoup.ui.getEnclosingNote(this);\nnote.set({\n\tonrender: function() {\n\t\tif (this.running) this.updateDisplay();\n\t\telse this.showInputForm();\n\t},\n\n\tshowInputForm: function() {\n\t\tvar myForm = new Ext.form.Form({\n\t\t\tlabelWidth: 75, \n\t\t\tlabelalign: 'top'\n\t\t});\n\t\tmyForm.add(\n\t\t\tnew Ext.form.TextField({\n\t\t\t\tfieldLabel: 'Subject',\n\t\t\t\tname: 'subject',\n\t\t\t\tvalue: this.notename,\n\t\t\t\twidth: 250\n\t\t\t}),\t\n\t\t\tnew Ext.form.TextField({\n\t\t\t\tfieldLabel: 'Deadline timestamp',\n\t\t\t\tname: 'deadline',\n\t\t\t\tvalue: this.deadline ? this.deadline : new Date(),\n\t\t\t\twidth: 250\n\t\t\t})\n\t\t);\n\t\tmyForm.addButton({\n\t\t\ttext: 'go',\n\t\t\thandler: this.submitForm,\n\t\t\tscope: this\n\t\t});\n\t\tvar thediv = this.getContentDiv();\n\t\tthediv.innerHTML = '<br/><center><h2>Countdown To Deadline</h2></center><br/>';\n\t\tmyForm.render(thediv);\n\t\tthis.setEphemeral('myForm', myForm);\n\t},\n\n\tsubmitForm: function(e) {\n\t\tvar v = this.getEphemeral('myForm').getValues();\n\t\tnotesoup.say('Starting countdown to: ' + v['subject'] + ' at ' + v['deadline']);\n\t\tthis.setupClock(v['subject'], v['deadline']);\n\t\tthis.save();\n\t},\n\n\tsetupClock: function(subject, deadline) {\n\t\tif (!subject || !deadline) return;\n\t\tvar t = new Date();\n\t\tthis.set({\n\t\t\trunning: true,\n\t\t\tediting: false,\n\t\t\tnotename: subject,\n\t\t\tdeadline: deadline,\n\t\t\tdeadlinetime: Date.parse(deadline)\n\t\t});\n\t\tExt.get(this.id + '_title').update(subject);\n\t\tthis.ontick = function() {this.onrender();}\n\t},\n\n\teditClock: function() {\n\t\tthis.editing = true;\n\t\tthis.show();\n\t},\n\t\n\tupdateDisplay: function() {\n\t\tvar timediff = this.deadlinetime - new Date().getTime();\n\t\tthis.setContentDiv([\n\t\t\t'<br/><h2><center>', \n\t\t\t\tnotesoup.stringifyTimeDiff(timediff), '<br/>',\n\t\t\t\t'until ', this.deadline,\n\t\t\t'</center></h2><br/>'\n\t\t].join(''));\n\t\tthis.ontick = function() {this.onrender();}\n\t}\n});\nnote.show();\n</script>","yPos":371,"height":40,"width":380,"notename":"Countdown Timer","mtime":1197984205.000000,"id":"noteuP8I4BLk"}