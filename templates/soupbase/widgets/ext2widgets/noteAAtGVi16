{"xPos":710,"from":"soupmaster in soupmaster/ext2widgets","bgcolor":"#CCFFCC","text":"<script type='text/javascript'>\n/**\n*\tcalculator.js - Note Soup calculator widget\n*\tCopyright 2007 by Bill Roy\n*\tAll rights reserved.\n*/\nvar note = notesoup.ui.getEnclosingNote(this);\nnote.set({\n\n\n\tontick: function() {\n\t\tif (this.getField('calculatorForm', 'autorecalc')) this.calc();\n\t},\n\t\n\tstart: function() {\n\t\tthis.setField('calculatorForm', 'autorecalc', true);\n\t},\n\n\tstop: function() {\n\t\tthis.setField('calculatorForm', 'autorecalc', false);\n\t},\n\n\tcalc: function() {\n\t\tthis.formula = this.getField('calculatorForm', 'formula');\n\t\tthis.autorecalc = this.getField('calculatorForm', 'autorecalc');\n\t\tthis.value = null;\n\t\ttry {\n\t\t\tthis.value = eval(this.formula);\n\t\t} catch (e) {\n\t\t\tthis.value = 'ERROR: ' + e;\n\t\t}\n\t\tthis.setField('calculatorForm', 'value', this.value);\n\t\treturn this.value;\n\t},\n\t\n\tsaveForm: function() {\n\t\tthis.formula = this.getField('calculatorForm', 'formula');\n\t\tthis.autorecalc = this.getField('calculatorForm', 'autorecalc');\n\t\tthis.save();\n\t},\n\n\tgetvalue: function() {\n\t\treturn this.value;\n\t},\n\n\tsetvalue: function(newformula) {\n\t\tthis.formula = newformula;\n\t\treturn this.calc();\n\t},\n\t\n\n\tonrender: function() {\n\n\t\tvar calculatorForm = new Ext.FormPanel({\n\t\t\tlabelWidth: 75,\n\t\t\twidth: this.width - 36,\n\t\t\tbodyStyle: 'background:' + (this.bgcolor || notesoup.ui.defaultNoteColor),\n\t\t\tborder: false,\n\t\t\tbodyBorder: false,\n\t\t\titems: [{\n\t\t\t\txtype: (this.formula && (this.formula.length > 40)) ? 'textarea' : 'textfield',\n\t\t\t\tfieldLabel: 'Formula',\n\t\t\t\tid: this.getFieldID('formula'),\n\t\t\t\tvalue: this.formula || '',\n\t\t\t\twidth: this.width - 36 - 86,\n\t\t\t\theight: (this.formula && (this.formula.length > 40)) ? Math.max(48, this.height - 85) : null\n\t\t\t},{\n\t\t\t\txtype: 'textfield',\n\t\t\t\tfieldLabel: 'Value',\n\t\t\t\tid: this.getFieldID('value'),\n\t\t\t\tvalue: this.value || '',\n\t\t\t\twidth: this.width - 36 - 86\n\t\t\t},{\n\t\t\t\txtype: 'checkbox',\n\t\t\t\tfieldLabel: 'Auto recalc',\n\t\t\t\tid: this.getFieldID('autorecalc'),\n\t\t\t\tchecked: this.autorecalc,\n\t\t\t}],\n\t\t\tbuttons: [{\n\t\t\t\ttext: 'Calc',\n\t\t\t\thandler: this.calc,\n\t\t\t\tscope: this\n\t\t\t},{\n\t\t\t\ttext: 'Save', \n\t\t\t\thandler: this.saveForm,\n\t\t\t\tscope: this\n\t\t\t}]\n\t\t});\n\n\t\tthis.setContentDiv('<br/>');\n\t\tcalculatorForm.render(this.getContentDiv());\n\t\tthis.setEphemeral('calculatorForm', calculatorForm);\n\n\t\tExt.get(this.getFieldID('formula')).on('focus', this.stop, this);\n\t\tExt.get(this.getFieldID('value')).on('focus', this.stop, this);\n\t}\n});\nnote.show();\n</script>","yPos":406,"height":168,"zIndex":124,"width":350,"autorecalc":false,"notename":"Calculator","mtime":1196963751.203176,"formula":"notesoup.stringifyTimeDiff(notesoup.sessionTime())","id":"noteAAtGVi16"}