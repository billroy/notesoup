{"xPos":284,"from":"soupmaster in soupmaster/@foo3","bgcolor":"#CCFFCC","text":"<script type='text/javascript'>\n/**\n*\tperiodicalreminder.js - Note Soup reminder widget\n*\tCopyright 2007 by Bill Roy\n*\tAll rights reserved.\n*/\nvar note = notesoup.ui.getEnclosingNote(this);\nnote.set({\n\n\tontick: function() {\n\t\ttry {\n\t\t\tif (this.running) this.updateDisplay();\n\t\t} catch (e) {\n\t\t\tnotesoup.say('pr onrender error: ' + notesoup.dump(e));\n\t\t}\n\t},\n\n\tonrender: function() {\n\t\tif (this.running) this.updateDisplay();\n\t\telse this.showInputForm();\n\t},\n\n\tshowInputForm: function() {\n\t\tvar reminderForm = new Ext.FormPanel({\n\t\t\tlabelWidth: 75,\n\t\t\twidth: this.width - 36,\n\t\t\tbodyStyle: 'background:' + (this.bgcolor || notesoup.ui.defaultNoteColor),\n\t\t\tborder: false,\n\t\t\tbodyBorder: false,\n\t\t\titems: [{\n\t\t\t\txtype: 'textfield',\n\t\t\t\tid: this.getFieldID('remindername'),\n\t\t\t\tfieldLabel: 'Subject',\n\t\t\t\tvalue: this.notename || '',\n\t\t\t\twidth: 175\n\t\t\t},{\n\t\t\t\txtype: 'textfield',\n\t\t\t\tfieldLabel: 'In how long',\n\t\t\t\tvalue: this.durationstring || '',\n\t\t\t\twidth: 175,\n\t\t\t\tid: this.getFieldID('duration'),\n\t\t\t},{\n\t\t\t\txtype: 'checkbox',\n\t\t\t\tid: this.getFieldID('autorestart'),\n\t\t\t\tfieldLabel: 'Auto restart',\n\t\t\t\tchecked: this.autorestart,\n\t\t\t}],\n\t\t\tbuttons: [{\n\t\t\t\ttext: 'remind me',\n\t\t\t\thandler: this.submitReminder,\n\t\t\t\tscope: this\n\t\t\t}]\n\t\t});\n\t\tvar thediv = this.getContentDiv();\n\t\tthediv.innerHTML = '<br/><center><h2>Periodical Reminder Settings</h2></center><br/>';\n\t\treminderForm.render(thediv);\n\t\tthis.setEphemeral('reminderForm', reminderForm);\n\t\t//Ext.get(thediv).addKeyListener(13, this.submitReminder, this);\n\t},\n\n\tsubmitReminder: function(e) {\n\t\tnotesoup.say('Setting reminder to: ' + this.getField('reminderForm', 'remindername') + ' in ' + this.getField('reminderForm', 'duration'));\n\t\tthis.setupClock(this.getField('reminderForm', 'remindername'), this.getField('reminderForm', 'duration'), this.getField('reminderForm', 'autorestart'));\n\t\tthis.startClock();\n\t\t//this.save();\n\t},\n\n\tsetupClock: function(name, duration, autorestart) {\n\t\tif (!name || !duration) return;\n\t\tvar t = new Date();\n\t\tthis.set({\n\t\t\tnotename: name,\n\t\t\tclockstartstring: t.toString(),\n\t\t\tclockstart: t.getTime(),\n\t\t\tclockduration: notesoup.getDuration(duration),\n\t\t\tdurationstring: duration,\n\t\t\tautorestart: autorestart\n\t\t});\n\t\tExt.get(this.id + '_title').update(name);\n\t},\n\n\tstartClock: function() {\n\t\tthis.running = true;\n\t\tthis.complete = false;\n\t\tthis.editing = false;\n\t\tthis.flash('#22f822');\n\t},\n\t\n\trestartClock: function() {\n\t\tthis.setupClock(this.notename, this.durationstring, this.autorestart);\n\t\tthis.startClock();\n\t},\n\n\tstopClock: function() {\n\t\tdelete this.running;\n\t\tvar outerDiv = Ext.get(this.id + notesoup.ui.divSuffix);\n\t\touterDiv.setStyle('opacity', 1.0);\n\t},\n\t\n\teditClock: function() {\n\t\tthis.stopClock();\n\t\tthis.editing = true;\n\t\tthis.show();\n\t},\n\t\n\tontimercomplete: function() {\n\t\tnotesoup.say('Ding! ' + this.notename);\n\t},\n\n\tupdateDisplay: function() {\n\n\t\tvar timediff = new Date().getTime() - this.clockstart;\n\t\tthis.completed = timediff / this.clockduration;\n\t\tif ((this.completed >= 1.0)  || (this.completed < 0)) {\n\t\t\tif (!this.complete) {\n\t\t\t\tthis.ontimercomplete();\n\t\t\t\tthis.complete = true;\n\t\t\t\tif (this.autorestart) this.restartClock();\n\t\t\t}\n\t\t}\n\t\tvar bg = '#ff3030';\n\t\tif (this.completed < 0.75) bg = '#80ff80';\n\t\telse if (this.completed < 0.90) bg = '#ffff30';\n\n\t\tthis.setContentDiv([\n\t\t\t'<br/><h2><center>', \n\t\t\t\tthis.complete ? 'PAST DUE<br/>' : '',\n\t\t\t\tnotesoup.stringifyTimeDiff(timediff), \n\t\t\t\t' (', ''+Math.floor(100 * this.completed), '%) of ', this.durationstring, '<br/>',\n\t\t\t\t'since ', ''+this.clockstartstring,\n\t\t\t'</center></h2><br/>'\n\t\t].join(''));\n\n\t\tvar outerDiv = Ext.get(this.id + notesoup.ui.divSuffix);\n\t\touterDiv.setStyle('opacity', '' + Math.max(0.05, this.completed));\n\t\t\n\t\touterDiv.on('dblclick', function(e) {\n\t\t\tvar thenote = notesoup.notes[notesoup.ui.getNoteIDFromWindowID(this.id)];\n\t\t\tthenote.editClock();\n\t\t\treturn true;\n\t\t});\n\t\t\n\t\tvar innerDiv = Ext.get(this.id + notesoup.ui.contentSuffix);\n\t\tinnerDiv.setStyle('background', bg);\n\t\tvar runningForm = new Ext.FormPanel({\n\t\t\tlabelWidth: 75,\n\t\t\twidth: this.width - 36,\n\t\t\tbodyStyle: 'background:' + (this.bgcolor || notesoup.ui.defaultNoteColor),\n\t\t\tborder: false,\n\t\t\tbodyBorder: false,\n\t\t\titems: [{\n\t\t\t\txtype: 'hidden',\n\t\t\t}],\n\t\t\tbuttons: [{\n\t\t\t\ttext: 'restart',\n\t\t\t\thandler: this.restartClock,\n\t\t\t\tscope: this\n\t\t\t},{\n\t\t\t\ttext: 'edit',\n\t\t\t\thandler: this.editClock,\n\t\t\t\tscope: this\n\t\t\t}]\n\t\t});\n\t\trunningForm.render(this.getContentDiv());\n\t}\t\n});\nnote.show();\n</script>","yPos":211,"height":198,"zIndex":98,"width":300,"notename":"periodical reminder","mtime":1196885782.280048,"id":"note0YlHmQnT"}