{"syncme":true,"xPos":12,"from":"system in system/widgets","width":250,"imports":"http://chowder.notesoup.net/js-src/js-widgets/avatar.js","yPos":396,"height":55,"zIndex":26,"bgcolor":"#ccffcc","text":"<script type='text/javascript'>\n/**\n*\tavatar.js - Note Soup avatar widget\n*\tCopyright 2007 by Bill Roy\n*\tAll rights reserved.\n*/\ntry {var note = notesoup.ui.getEnclosingNote(this);\nnote.set({\n\n\tinit: function() {\n\t\t//notesoup.say('Avatar here!', 'tell');\n\t\tif (this.isHome()) {\n\t\t\tthis.follow = true;\n\t\t\tthis.think(\"g'day!\");\n\t\t\t// slide on down\n\t\t\tvar maxy = 0;\n\t\t\tfor (var n in notesoup.notes) {\n\t\t\t\tif (n == this.id) continue;\n\t\t\t\tif (notesoup.notes[n].imports == this.imports) {\n\n\t\t\t\t\t// if it was dragged out of the alley, ignore it\n\t\t\t\t\tif (notesoup.notes[n].xPos > 25) continue;\n\n\t\t\t\t\tvar y = notesoup.notes[n].yPos;\n\t\t\t\t\tif (typeof(y) != 'number') y = parseInt(y);\n\t\t\t\t\tif (y > maxy) maxy = y;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar myY = this.yPos;\n\t\t\tif (typeof(myY) != 'number') myY = parseInt(myY);\n\t\t\tif (maxy >= myY) {\n\t\t\t\tthis.moveTo(12,  maxy + this.height + 12);\n\t\t\t\tnotesoup.refreshAvatar.defer(500, notesoup);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.think('hi!');\n\t\t\t//this.draggable = false;\n\t\t}\n\t\tExt.get(this.id).on('contextmenu', this.doMenu, this);\n\t},\n\n\tisHome: function() {\n\t\treturn (this.username && this.clientid && notesoup.username && notesoup.pushClientID &&\n\t\t\t(this.username == notesoup.username) && (this.clientid == notesoup.pushClientID));\n\t},\n\n\tontick: function() {\n\t\t// fidget the widget\n\t\tif (this.isHome() && (Math.random() < .05)) {\n\t\t\tvar dx = 12;\n\t\t\tvar dy = 3;\n\t\t\tthis.think('fidget...');\n\t\t\tthis.bump(Math.floor(Math.random() * dx) - dx/2,\n\t\t\t\t\t\tMath.floor(Math.random() * dy) - dy/2);\n\t\t\tnotesoup.refreshAvatar.defer(500, notesoup);\n\t\t}\n\t},\n\n\tonsay: function(request) {\n\t\tif ((request.sender == this.username) && (request.clientid == this.clientid)) {\n\t\t\tthis.think(request.data);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\t\n\tonleave: function(request) {\n\t\tif ((request.data.username == this.username) && (request.clientid == this.clientid)) {\n\t\t\tnotesoup.destroyNote(this.id);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\tdoMenu: function(e) {\n\t\te.stopEvent();\n\t\tthis.isHome() ? this.doHomeMenu(e) : this.doAwayMenu(e);\n\t},\n\t\n\ttoggleFollow: function() {\n\t\tthis.follow = !this.follow;\n\t\tthis.think(this.follow ? 'Following, aye.' : 'Standing by....');\n\t},\n\n\tdoHomeMenu: function(e) {\n\n\t\tvar avatarHomeMenu = new Ext.menu.Menu({\n\t\t\tid: 'avatarHomeMenu',\n\t\t\titems: [\n\t\t\t\t{text: 'Dismiss', handler: function(e) {\n\t\t\t\t\tnotesoup.removeAvatar();\n\t\t\t\t}, icon: notesoup.imageHost + 'images/famfamfam.com/user_delete.png'},\n\t\t\t\tnew Ext.menu.CheckItem({\n\t\t\t\t\ttext: 'Follow Me', \n\t\t\t\t\tchecked: this.follow,\n\t\t\t\t\thandler: this.toggleFollow,\n\t\t\t\t\tscope: this\n\t\t\t\t}),\n\t\t\t\t'-',\n\t\t\t\t{text: 'Say...', handler: function(e) {\n\t\t\t\t\tvar s = prompt(\"What would you like to say?\", '');\n\t\t\t\t\tif (s) notesoup.folderSay(s);\n\t\t\t\t}, icon: notesoup.imageHost + 'images/famfamfam.com/comment.png'},\n\t\t\t\t{text: 'Flash...', handler: function(e) {\n\t\t\t\t\tvar s = prompt(\"Flash what?\", '');\n\t\t\t\t\tif (s) notesoup.folderFlash(s);\n\t\t\t\t}, icon: notesoup.imageHost + 'images/famfamfam.com/sound.png'},\n\t\t\t\t{text: 'Transport Everybody to...', handler: function(e) {\n\t\t\t\t\tvar s = prompt(\"Beam everybody where?\", '');\n\t\t\t\t\tif (s) notesoup.folderSee(s);\n\t\t\t\t}, icon: notesoup.imageHost + 'images/famfamfam.com/application_go.png'},\n\t\t\t\t'-',\n\t\t\t\t{text: 'Ping', handler: function(e) {\n\t\t\t\t\tnotesoup.folderPing();\n\t\t\t\t}, icon: notesoup.imageHost + 'images/famfamfam.com/transmit_blue.png'},\n\t\t\t\t'-',\n\t\t\t\t{text: 'Sync All', handler: function(e) {\n\t\t\t\t\tnotesoup.folderSync();\n\t\t\t\t}, icon: notesoup.imageHost + 'images/famfamfam.com/arrow_refresh.png'},\n\t\t\t\t{text: 'Refresh All', handler: function(e) {\n\t\t\t\t\tnotesoup.folderRefresh();\n\t\t\t\t}, icon: notesoup.imageHost + 'images/famfamfam.com/arrow_redo.png'},\n\t\t\t\t'-',\n\t\t\t\t{text: 'Remote console...', handler: function(e) {\n\t\t\t\t\tvar s = prompt(\"Rcon what? (don't be a jerk)\", '');\n\t\t\t\t\tif (s) notesoup.folderRcon(s);\n\t\t\t\t}, icon: notesoup.imageHost + 'images/famfamfam.com/eye.png'},\n\t\t\t\t'-',\n\t\t\t\t{text: 'Info...', handler: this.info, scope: this,\n\t\t\t\t\ticon: notesoup.imageHost + 'images/famfamfam.com/information.png'}\n\t\t\t]\n\t\t});\n\t\tavatarHomeMenu.showAt(e.getXY());\n\t},\n\t\n\tkick: function() {\n\t\tnotesoup.folderSay(notesoup.username + 'is kicking ' + this.username);\n\t\tvar kickstr = [\n\t\t\t\"=if (notesoup.username == '\", this.username,\"') notesoup.logout();\"\n\t\t].join('');\n\t\t// thrice i kick thee\n\t\tnotesoup.folderRcon(kickstr);\n\t\tnotesoup.folderRcon(kickstr);\n\t\tnotesoup.folderRcon(kickstr);\n\t},\n\n\tthwack: function(whom, howlong) {\n\t\tif (!howlong) howlong = 5000;\n\t\tif (notesoup.username == whom) {\n\t\t\tnotesoup.frontstage.show('thwack!', 'yellow');\n\t\t\tnotesoup.frontstage.hide.defer(howlong);\n\t\t}\n\t\telse this.think('ouch!');\n\t},\n\t\n\tinfo: function() {\n\t\treturn(notesoup.say(notesoup.dump(this)));\n\t},\n\n\tdoAwayMenu: function(e) {\n\t\tvar avatarAwayMenu = new Ext.menu.Menu({\n\t\t\tid: 'avatarAwayMenu',\n\t\t\titems: [{text: 'Whisper privately...', handler: function(e) {\n\t\t\t\t\tvar msg = prompt('Whisper what to ' + this.username + '?', '');\n\t\t\t\t\tif (msg) notesoup.tell(this.username, msg);\n\t\t\t\t}, icon: notesoup.imageHost + 'images/famfamfam.com/comment.png'},\n\t\t\t\t{text: 'Thwack', handler: function(e) {\n\t\t\t\t\tnotesoup.folderSay(notesoup.username + ' thwacks ' + this.username, 'warning');\n\t\t\t\t\tthis.sendself('thwack', this.username);\n\t\t\t\t}, icon: notesoup.imageHost + 'images/famfamfam.com/home_go.png'},\n\t\t\t\t{text: 'Kick Out', handler: this.kick, scope: this,\n\t\t\t\t\ticon: notesoup.imageHost + 'images/famfamfam.com/home_go.png'},\n\t\t\t\t'-',\n\t\t\t\t{text: 'Info...', handler: this.info, scope: this,\n\t\t\t\t\ticon: notesoup.imageHost + 'images/famfamfam.com/information.png'}\n\t\t\t]\n\t\t});\n\t\tavatarAwayMenu.showAt(e.getXY());\n\t}\n});\nnote.init();} catch(e) {notesoup.say('widget load error: ' + notesoup.dump(e), 'error');}\n</script>\nAvatar widget is go.","notename":"Avatar","mtime":1203791184,"id":"noteqBlWATWJ"}